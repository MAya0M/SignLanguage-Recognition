# הסבר על פתרון EC2 - איך זה עובד?

## מה זה EC2?

**Amazon EC2 (Elastic Compute Cloud)** = מחשב וירטואלי בענן של AWS.

זה כמו שכירת מחשב חזק ב-AWS שיכול לרוץ עם GPU לאימון מודלים.

---

## למה EC2 ולא SageMaker?

### SageMaker:
- **יקר יותר**: ~$3/שעה (ml.p3.2xlarge)
- **ניהול אוטומטי**: AWS מנהל הכל
- **פחות גמישות**: מוגבל למה ש-SageMaker תומך

### EC2:
- **זול יותר**: ~$0.50/שעה (g4dn.xlarge) או **$0.05/שעה עם Spot** (90% הנחה!)
- **שליטה מלאה**: אתה מנהל הכל
- **גמישות**: יכול להתקין כל מה שרוצים

**ההבדל העיקרי**: EC2 = מחשב שלך בענן, SageMaker = שירות מוכן.

---

## איך זה עובד? (פשוט)

### 1. אתה מפעיל "מחשב" ב-AWS

```
┌─────────────────────────────────┐
│   המחשב שלך (מקומי)             │
│   - חלש מדי לאימון              │
│   - אין GPU                      │
└─────────────────────────────────┘
              │
              │ SSH Connection
              ▼
┌─────────────────────────────────┐
│   EC2 Instance (ב-AWS)          │
│   - מחשב חזק עם GPU             │
│   - Ubuntu Linux                 │
│   - TensorFlow מוכן              │
└─────────────────────────────────┘
```

### 2. תהליך העבודה:

```
1. אתה → הפעל EC2 instance (דרך AWS Console)
   ↓
2. AWS → נותן לך מחשב עם IP address
   ↓
3. אתה → מתחבר דרך SSH (כמו להתחבר למחשב אחר)
   ↓
4. אתה → מעתיק את הפרויקט והנתונים
   ↓
5. אתה → מריץ אימון על המחשב החזק
   ↓
6. אתה → שומר את המודל ב-S3
   ↓
7. אתה → מוריד את המודל למחשב המקומי
   ↓
8. אתה → מכבה את ה-instance (כדי לא לשלם)
```

---

## דוגמה מעשית

### שלב 1: הפעלת Instance

**ב-AWS Console:**
1. היכנס ל-EC2
2. לחץ "Launch Instance"
3. בחר:
   - **AMI**: Deep Learning AMI (Ubuntu) - מכיל TensorFlow מוכן
   - **Instance Type**: g4dn.xlarge (GPU)
   - **Storage**: 50GB
   - **Key Pair**: בחר או צור (קובץ .pem)
4. לחץ "Launch"

**תוצאה**: יש לך מחשב ב-AWS עם כתובת IP, למשל: `54.123.45.67`

### שלב 2: התחברות

**מהמחשב המקומי:**
```bash
ssh -i your-key.pem ubuntu@54.123.45.67
```

**תוצאה**: אתה בתוך המחשב ב-AWS! זה כמו terminal של מחשב אחר.

### שלב 3: העתקת הפרויקט

**אפשרות 1: Git (אם יש repository)**
```bash
git clone YOUR_REPO_URL
```

**אפשרות 2: SCP (העתקה מהמחשב המקומי)**
```bash
# מהמחשב המקומי (PowerShell)
scp -i your-key.pem -r . ubuntu@54.123.45.67:~/signlanguage/
```

**אפשרות 3: S3 (אם העלית ל-S3)**
```bash
# ב-EC2
aws s3 sync s3://your-bucket/signlanguage/ ./signlanguage/
```

### שלב 4: הורדת נתונים

```bash
# ב-EC2
aws s3 sync s3://your-bucket/data/Data/ ./Data/
```

### שלב 5: אימון

```bash
# ב-EC2
cd signlanguage
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt

# הרץ אימון
python scripts/train_model.py --csv Data/Labels/dataset.csv ...
```

**חשוב**: השתמש ב-`screen` כדי שהאימון ימשיך גם אם ההתחברות תתנתק:
```bash
screen -S training
# הרץ את האימון
# לחץ Ctrl+A, D לניתוק
# screen -r training להתחברות מחדש
```

### שלב 6: שמירת המודל

```bash
# ב-EC2 - שמור ל-S3
aws s3 sync models/ s3://your-bucket/models/
```

### שלב 7: הורדת המודל

```bash
# מהמחשב המקומי
aws s3 sync s3://your-bucket/models/ ./models/
```

### שלב 8: כיבוי Instance

**חשוב מאוד!** כבה את ה-instance כדי לא לשלם:
```bash
# דרך Console: EC2 → Instances → Stop/Terminate
# או דרך CLI:
aws ec2 stop-instances --instance-ids i-xxxxxxxxxxxxx
```

---

## Spot Instances - החיסכון הגדול

### מה זה Spot?

AWS מוכר instances שלא בשימוש במחיר מוזל (עד 90% הנחה).

**דוגמה:**
- מחיר רגיל: $0.50/שעה
- מחיר Spot: $0.05/שעה (90% הנחה!)

### אזהרה:

AWS יכול לעצור את ה-instance אם הם צריכים את המשאבים (2 דקות התראה).

**פתרון:**
- שמור checkpoints תכופים (המודל שומר אוטומטית)
- אם ה-instance נעצר, פשוט הפעל מחדש והמשך מהמקום שעצרת

### איך להפעיל Spot:

1. ב-"Launch Instance"
2. סמן "Request Spot Instances"
3. בחר "Max price" - 70% מהמחיר הרגיל (בטוח)
4. או השאר "On-demand price" (יותר בטוח, אבל עדיין זול)

---

## עלויות - דוגמאות

### תרחיש 1: אימון של 4 שעות

**On-Demand (מחיר רגיל):**
- g4dn.xlarge: $0.50/שעה × 4 = **$2.00**

**Spot Instance:**
- g4dn.xlarge: $0.05/שעה × 4 = **$0.20**

**חיסכון: 90%!**

### תרחיש 2: אימון של 10 שעות

**On-Demand:** $5.00  
**Spot:** $0.50

---

## יתרונות EC2

✅ **זול** - במיוחד עם Spot  
✅ **שליטה מלאה** - אתה מנהל הכל  
✅ **גמישות** - יכול להתקין כל דבר  
✅ **מהיר** - GPU חזק  
✅ **נוח** - Deep Learning AMI מוכן עם TensorFlow  

## חסרונות EC2

❌ **צריך לנהל בעצמך** - התקנות, backups, וכו'  
❌ **יכול להיפסק** (Spot) - אבל יש פתרונות  
❌ **צריך לזכור לכבות** - אחרת משלמים  

---

## השוואה: EC2 vs SageMaker

| תכונה | EC2 | SageMaker |
|------|-----|-----------|
| **עלות** | $0.05-0.50/שעה | $3/שעה |
| **ניהול** | אתה מנהל | AWS מנהל |
| **גמישות** | מלאה | מוגבלת |
| **קלות שימוש** | צריך ידע טכני | פשוט יותר |
| **GPU** | כן | כן |
| **Spot Instances** | כן (90% הנחה) | לא |

**המלצה**: לפרויקטים קטנים-בינוניים → **EC2 עם Spot** (זול יותר)

---

## Workflow מלא - סיכום

```
1. הכן נתונים מקומית
   ↓
2. העלה ל-S3
   ↓
3. הפעל EC2 instance (Spot)
   ↓
4. התחבר דרך SSH
   ↓
5. הורד נתונים מ-S3
   ↓
6. הרץ אימון ב-screen
   ↓
7. שמור מודל ל-S3 (תכופות!)
   ↓
8. הורד מודל למחשב המקומי
   ↓
9. כבה instance
```

**זמן כולל**: 4-6 שעות אימון  
**עלות**: $0.20-$2.00 (תלוי ב-instance type)

---

## טיפים חשובים

1. **תמיד שמור ל-S3** - כל epoch או כל 10 epochs
2. **השתמש ב-screen** - כדי שהאימון ימשיך גם אם ההתחברות תתנתק
3. **הגדר billing alerts** - כדי לדעת אם אתה משלם יותר מדי
4. **כבה instance מיד** - כשסיימת, כדי לא לשלם
5. **Spot Instances** - מומלץ מאוד, חוסך הרבה כסף

---

## שאלות נפוצות

**Q: מה אם ה-instance נפסק (Spot)?**  
A: המודל שומר checkpoints אוטומטית. פשוט הפעל instance חדש והמשך.

**Q: כמה זמן לוקח להפעיל instance?**  
A: 2-5 דקות.

**Q: צריך ידע טכני?**  
A: בסיסי - SSH, Linux commands בסיסיים. המדריך מפורט.

**Q: מה אם אני שוכח לכבות?**  
A: הגדר billing alerts ב-AWS. אבל תמיד תזכור לכבות!

**Q: איך אני יודע כמה זה עלה?**  
A: AWS Cost Explorer או Billing Dashboard.

---

## סיכום

**EC2 = שכירת מחשב חזק ב-AWS**

- אתה מפעיל מחשב וירטואלי
- מתחבר אליו דרך SSH
- מריץ את האימון שם
- מוריד את התוצאות
- מכבה את המחשב

**עם Spot Instances: זול מאוד (פחות מדולר לאימון מלא!)**

---

**רוצה להתחיל?** ראה [docs/AWS_EC2_GUIDE.md](docs/AWS_EC2_GUIDE.md) למדריך מפורט שלב-אחר-שלב.

