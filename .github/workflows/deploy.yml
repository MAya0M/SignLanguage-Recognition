name: Deploy App

on:
  push:
    branches: [ main, master ]
  workflow_dispatch:  # Allow manual trigger

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
    
    - name: Check if model exists
      id: check_model
      run: |
        if [ -d "models" ] && [ "$(ls -A models/run_*/best_model.keras 2>/dev/null)" ]; then
          echo "model_exists=true" >> $GITHUB_OUTPUT
          echo "âœ… Model found"
        else
          echo "model_exists=false" >> $GITHUB_OUTPUT
          echo "âš ï¸ No model found - app will show warning"
        fi
    
    - name: Create deployment package
      run: |
        echo "ðŸ“¦ Creating deployment package..."
        echo "âœ… App ready for deployment"
    
    - name: Deployment Summary
      run: |
        echo "## ðŸš€ Deployment Ready" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "âœ… Code checked" >> $GITHUB_STEP_SUMMARY
        echo "âœ… Dependencies installed" >> $GITHUB_STEP_SUMMARY
        if [ "${{ steps.check_model.outputs.model_exists }}" == "true" ]; then
          echo "âœ… Model found" >> $GITHUB_STEP_SUMMARY
        else
          echo "âš ï¸ No model found" >> $GITHUB_STEP_SUMMARY
        fi
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "ðŸ“– To deploy:" >> $GITHUB_STEP_SUMMARY
        echo "1. Connect to Railway/Render/Heroku" >> $GITHUB_STEP_SUMMARY
        echo "2. Enable auto-deploy from GitHub" >> $GITHUB_STEP_SUMMARY
        echo "3. See docs/DEPLOYMENT_GUIDE.md for details" >> $GITHUB_STEP_SUMMARY
